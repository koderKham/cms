{% extends "base.html" %}

{% block title %}{{ client.name }} | Clients | Law Firm CMS{% endblock %}

{% block additional_css %}
<style>
    .client-header {
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.35rem 0.65rem;
        border-radius: 0.25rem;
        font-weight: 700;
    }
    
    .status-active { background-color: #d4edda; color: #155724; }
    .status-inactive { background-color: #f8d7da; color: #721c24; }
    
    .info-group {
        margin-bottom: 1rem;
    }
    
    .info-label {
        font-weight: 500;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }
    
    .info-value {
        font-size: 1.05rem;
    }
    
    .tab-content {
        padding-top: 1.5rem;
    }
    
    .case-status {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 700;
    }
    .status-open { background-color: #d4edda; color: #155724; }
    .status-pending { background-color: #fff3cd; color: #856404; }
    .status-closed { background-color: #d6d8db; color: #383d41; }
    .status-archived { background-color: #f8d7da; color: #721c24; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        {% include "partials/sidebar.html" %}
        
        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('clients.index') }}">Clients</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ client.name }}</li>
                    </ol>
                </nav>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{{ url_for('clients.edit', id=client.id) }}" class="btn btn-sm btn-primary me-2">
                        <i class="fas fa-edit me-1"></i> Edit Client
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-cog me-1"></i> Actions
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="{{ url_for('cases.create') }}">
                                    <i class="fas fa-gavel me-1"></i> New Case for Client
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-file-invoice-dollar me-1"></i> Generate Statement
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-envelope me-1"></i> Send Email
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{{ url_for('clients.toggle_status', id=client.id) }}" method="POST" class="status-form">
                                    <button type="submit" class="dropdown-item text-{{ 'warning' if client.is_active else 'success' }}">
                                        <i class="fas fa-{{ 'user-slash' if client.is_active else 'user-check' }} me-1"></i>
                                        {{ 'Deactivate Client' if client.is_active else 'Activate Client' }}
                                    </button>
                                </form>
                            </li>
                            <li>
                                <form action="{{ url_for('clients.delete', id=client.id) }}" method="POST" class="delete-form">
                                    <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Are you sure you want to delete this client?')">
                                        <i class="fas fa-trash-alt me-1"></i> Delete Client
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Client header -->
            <div class="client-header shadow-sm">
                <div class="row">
                    <div class="col-md-8">
                        <h1 class="h2 mb-2">{{ client.name }}</h1>
                        <p class="mb-3">
                            <span class="text-muted me-3">{{ client.client_type|title }}</span>
                            {% if client.company_name %}
                            <span class="text-muted me-3">{{ client.company_name }}</span>
                            {% endif %}
                            <span class="status-badge status-{{ 'active' if client.is_active else 'inactive' }}">
                                {{ 'Active' if client.is_active else 'Inactive' }}
                            </span>
                        </p>
                        <div class="row">
                            {% if client.email %}
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-envelope me-2"></i>
                                <a href="mailto:{{ client.email }}">{{ client.email }}</a>
                            </div>
                            {% endif %}
                            {% if client.phone %}
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-phone me-2"></i>
                                <a href="tel:{{ client.phone }}">{{ client.phone }}</a>
                            </div>
                            {% endif %}
                            {% if client.address %}
                            <div class="col-md-12">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                {{ client.full_address }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Client Since:</span>
                                    <span>{{ client.created_at.strftime('%Y-%m-%d') }}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Active Cases:</span>
                                    <span class="badge bg-info">{{ client.active_cases_count }}</span>
                                </div>
                                {% if client.date_of_birth %}
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Date of Birth:</span>
                                    <span>{{ client.date_of_birth.strftime('%Y-%m-%d') }}</span>
                                </div>
                                {% endif %}
                                {% if client.referral_source %}
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Referral:</span>
                                    <span>{{ client.referral_source }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Client details tabs -->
            <ul class="nav nav-tabs" id="clientDetailsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Details</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cases-tab" data-bs-toggle="tab" data-bs-target="#cases" type="button" role="tab" aria-controls="cases" aria-selected="false">Cases</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab" aria-controls="billing" aria-selected="false">Billing</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">Documents</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes" aria-selected="false">Notes</button>
                </li>
            </ul>
            
            <div class="tab-content" id="clientDetailsContent">
                <!-- Details tab -->
                <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Contact Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="info-group">
                                        <div class="info-label">Name</div>
                                        <div class="info-value">{{ client.name }}</div>
                                    </div>
                                    {% if client.email %}
                                    <div class="info-group">
                                        <div class="info-label">Email</div>
                                        <div class="info-value">
                                            <a href="mailto:{{ client.email }}">{{ client.email }}</a>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if client.phone %}
                                    <div class="info-group">
                                        <div class="info-label">Phone</div>
                                        <div class="info-value">
                                            <a href="tel:{{ client.phone }}">{{ client.phone }}</a>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if client.address %}
                                    <div class="info-group">
                                        <div class="info-label">Address</div>
                                        <div class="info-value">
                                            {{ client.address }}<br>
                                            {% if client.city %}{{ client.city }}{% endif %}
                                            {% if client.state %}{{ ', ' + client.state }}{% endif %}
                                            {% if client.postal_code %}{{ ' ' + client.postal_code }}{% endif %}
                                            {% if client.country and client.country != 'United States' %}
                                                <br>{{ client.country }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            {% if client.client_type == 'individual' %}
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Personal Information</h5>
                                </div>
                                <div class="card-body">
                                    {% if client.date_of_birth %}
                                    <div class="info-group">
                                        <div class="info-label">Date of Birth</div>
                                        <div class="info-value">{{ client.date_of_birth.strftime('%Y-%m-%d') }}</div>
                                    </div>
                                    {% endif %}
                                    {% if client.ssn_last_four %}
                                    <div class="info-group">
                                        <div class="info-label">Last 4 of SSN</div>
                                        <div class="info-value">XXX-XX-{{ client.ssn_last_four }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% else %}
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Business Information</h5>
                                </div>
                                <div class="card-body">
                                    {% if client.company_name %}
                                    <div class="info-group">
                                        <div class="info-label">Company Name</div>
                                        <div class="info-value">{{ client.company_name }}</div>
                                    </div>
                                    {% endif %}
                                    {% if client.industry %}
                                    <div class="info-group">
                                        <div class="info-label">Industry</div>
                                        <div class="info-value">{{ client.industry }}</div>
                                    </div>
                                    {% endif %}
                                    {% if client.tax_id %}
                                    <div class="info-group">
                                        <div class="info-label">Tax ID</div>
                                        <div class="info-value">{{ client.tax_id }}</div>
                                    </div>
                                    {% endif %}
                                    {% if client.website %}
                                    <div class="info-group">
                                        <div class="info-label">Website</div>
                                        <div class="info-value">
                                            <a href="{{ client.website if client.website.startswith('http') else 'http://' + client.website }}" target="_blank">
                                                {{ client.website }}
                                            </a>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Additional Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="info-group">
                                        <div class="info-label">Client Type</div>
                                        <div class="info-value">{{ client.client_type|title }}</div>
                                    </div>
                                    {% if client.referral_source %}
                                    <div class="info-group">
                                        <div class="info-label">Referral Source</div>
                                        <div class="info-value">{{ client.referral_source }}</div>
                                    </div>
                                    {% endif %}
                                    <div class="info-group">
                                        <div class="info-label">Status</div>
                                        <div class="info-value">
                                            <span class="status-badge status-{{ 'active' if client.is_active else 'inactive' }}">
                                                {{ 'Active' if client.is_active else 'Inactive' }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="info-group">
                                        <div class="info-label">Client Since</div>
                                        <div class="info-value">{{ client.created_at.strftime('%Y-%m-%d') }}</div>
                                    </div>
                                    <div class="info-group">
                                        <div class="info-label">Last Updated</div>
                                        <div class="info-value">{{ client.updated_at.strftime('%Y-%m-%d') }}</div>
                                    </div>
                                </div>
                            </div>
                            
                            {% if client.notes %}
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Notes</h5>
                                </div>
                                <div class="card-body">
                                    <p>{{ client.notes|nl2br }}</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Cases tab -->
                <div class="tab-pane fade" id="cases" role="tabpanel" aria-labelledby="cases-tab">
                    <div class="d-flex justify-content-between mb-3">
                        <h4>Client Cases</h4>
                        <a href="{{ url_for('cases.create') }}" class="btn btn-sm btn-primary">
                            <i class="fas fa-plus me-1"></i> New Case
                        </a>
                    </div>
                    
                    {% if cases %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Case Title</th>
                                    <th>Case Number</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Filing Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for case in cases %}
                                <tr>
                                    <td>
                                        <a href="{{ url_for('cases.view', id=case.id) }}">{{ case.title }}</a>
                                    </td>
                                    <td>{{ case.case_number or 'N/A' }}</td>
                                    <td>{{ case.type|title }}</td>
                                    <td>
                                        <span class="case-status status-{{ case.status }}">{{ case.status|title }}</span>
                                    </td>
                                    <td>{{ case.filing_date.strftime('%Y-%m-%d') if case.filing_date else 'N/A' }}</td>
                                    <td>
                                        <a href="{{ url_for('cases.view', id=case.id) }}" class="btn btn-sm btn-outline-primary">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> No cases found for this client.
                        <a href="{{ url_for('cases.create') }}" class="alert-link">Create a new case</a>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Other tabs (placeholder content) -->
                <div class="tab-pane fade" id="billing" role="tabpanel" aria-labelledby="billing-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Billing features will be implemented soon.
                    </div>
                </div>
                
                <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Document management features will be implemented soon.
                    </div>
                </div>
                
                <div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="notes-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Notes features will be implemented soon.
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Activate tabs from URL hash if present
        const hash = window.location.hash;
        if (hash) {
            const tab = document.querySelector(`#clientDetailsTabs a[href="${hash}"]`);
            if (tab) {
                tab.tab('show');
            }
        }
        
        // Update URL hash when tabs change
        const tabElements = document.querySelectorAll('#clientDetailsTabs button');
        tabElements.forEach(tab => {
            tab.addEventListener('shown.bs.tab', function(e) {
                const id = e.target.getAttribute('data-bs-target');
                if (history.pushState) {
                    history.pushState(null, null, id);
                } else {
                    location.hash = id;
                }
            });
        });
    });
</script>
{% endblock %}