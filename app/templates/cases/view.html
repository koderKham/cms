{% extends "base.html" %}

{% block title %}{{ case.title }} | Cases | Law Firm CMS{% endblock %}

{% block additional_css %}
<style>
    .case-header {
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.35rem 0.65rem;
        border-radius: 0.25rem;
        font-weight: 700;
    }
    
    .status-open { background-color: #d4edda; color: #155724; }
    .status-pending { background-color: #fff3cd; color: #856404; }
    .status-closed { background-color: #d6d8db; color: #383d41; }
    .status-archived { background-color: #f8d7da; color: #721c24; }
    
    .info-group {
        margin-bottom: 1rem;
    }
    
    .info-label {
        font-weight: 500;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }
    
    .info-value {
        font-size: 1.05rem;
    }
    
    .tab-content {
        padding-top: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        {% include "partials/sidebar.html" %}
        
        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('cases.index') }}">Cases</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ case.title }}</li>
                    </ol>
                </nav>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{{ url_for('cases.edit', id=case.id) }}" class="btn btn-sm btn-primary me-2">
                        <i class="fas fa-edit me-1"></i> Edit Case
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-cog me-1"></i> Actions
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-file-alt me-1"></i> Add Document</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-calendar-plus me-1"></i> Schedule Event</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sticky-note me-1"></i> Add Note</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-clock me-1"></i> Log Time</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-file-invoice-dollar me-1"></i> Create Invoice</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{{ url_for('cases.delete', id=case.id) }}" method="POST" class="delete-form">
                                    <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Are you sure you want to delete this case?')">
                                        <i class="fas fa-trash-alt me-1"></i> Delete Case
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Case header -->
            <div class="case-header shadow-sm">
                <div class="row">
                    <div class="col-md-8">
                        <h1 class="h2 mb-2">{{ case.title }}</h1>
                        <p class="mb-3">
                            <span class="text-muted me-3">{{ case.type|title }}</span>
                            {% if case.case_number %}
                            <span class="text-muted me-3">Case #: {{ case.case_number }}</span>
                            {% endif %}
                            <span class="status-badge status-{{ case.status }}">{{ case.status|title }}</span>
                        </p>
                        {% if case.description %}
                        <p>{{ case.description }}</p>
                        {% endif %}
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Created:</span>
                                    <span>{{ case.created_at.strftime('%Y-%m-%d') }}</span>
                                </div>
                                {% if case.client %}
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Client:</span>
                                    <span>{{ case.client.name }}</span>
                                </div>
                                {% endif %}
                                {% if case.lead_attorney %}
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Lead Attorney:</span>
                                    <span>{{ case.lead_attorney.name }}</span>
                                </div>
                                {% endif %}
                                {% if case.filing_date %}
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Filing Date:</span>
                                    <span>{{ case.filing_date.strftime('%Y-%m-%d') }}</span>
                                </div>
                                {% endif %}
                                {% if case.hearing_date %}
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Hearing Date:</span>
                                    <span class="{% if case.hearing_date|string < now|string %}text-danger{% endif %}">
                                        {{ case.hearing_date.strftime('%Y-%m-%d') }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Case details tabs -->
            <ul class="nav nav-tabs" id="caseDetailsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Details</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">Documents</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button" role="tab" aria-controls="timeline" aria-selected="false">Timeline</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab" aria-controls="billing" aria-selected="false">Billing</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes" aria-selected="false">Notes</button>
                </li>
            </ul>
            
            <div class="tab-content" id="caseDetailsContent">
                <!-- Details tab -->
                <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Case Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Court</div>
                                                <div class="info-value">{{ case.court_name or 'N/A' }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Judge</div>
                                                <div class="info-value">{{ case.judge_name or 'N/A' }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-group">
                                        <div class="info-label">Opposing Counsel</div>
                                        <div class="info-value">{{ case.opposing_counsel or 'N/A' }}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Financial Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Hourly Rate</div>
                                                <div class="info-value">${{ case.hourly_rate or '0.00' }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Retainer Amount</div>
                                                <div class="info-value">${{ case.retainer_amount or '0.00' }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Total Billed</div>
                                                <div class="info-value">${{ case.total_billed or '0.00' }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="info-group">
                                                <div class="info-label">Total Paid</div>
                                                <div class="info-value">${{ case.total_paid or '0.00' }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Upcoming Deadlines</h5>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted">No upcoming deadlines.</p>
                                    <!-- This will be populated once we add the deadlines model -->
                                </div>
                                <div class="card-footer text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary">Add Deadline</a>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Client Information</h5>
                                </div>
                                <div class="card-body">
                                    {% if case.client %}
                                    <h5>{{ case.client.name }}</h5>
                                    {% if case.client.email %}
                                    <p class="mb-2">
                                        <i class="fas fa-envelope me-2"></i>
                                        <a href="mailto:{{ case.client.email }}">{{ case.client.email }}</a>
                                    </p>
                                    {% endif %}
                                    {% if case.client.phone %}
                                    <p class="mb-2">
                                        <i class="fas fa-phone me-2"></i>
                                        <a href="tel:{{ case.client.phone }}">{{ case.client.phone }}</a>
                                    </p>
                                    {% endif %}
                                    {% if case.client.address %}
                                    <p class="mb-0">
                                        <i class="fas fa-map-marker-alt me-2"></i>
                                        {{ case.client.address }}<br>
                                        {% if case.client.city %}
                                            {{ case.client.city }},
                                        {% endif %}
                                        {% if case.client.state %}
                                            {{ case.client.state }}
                                        {% endif %}
                                        {% if case.client.postal_code %}
                                            {{ case.client.postal_code }}
                                        {% endif %}
                                    </p>
                                    {% endif %}
                                    {% else %}
                                    <p class="text-muted">No client associated with this case.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Other tabs (placeholder content) -->
                <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Document management features will be implemented soon.
                    </div>
                </div>
                
                <div class="tab-pane fade" id="timeline" role="tabpanel" aria-labelledby="timeline-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Case timeline features will be implemented soon.
                    </div>
                </div>
                
                <div class="tab-pane fade" id="billing" role="tabpanel" aria-labelledby="billing-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Billing management features will be implemented soon.
                    </div>
                </div>
                
                <div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="notes-tab">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Case notes features will be implemented soon.
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Activate tabs from URL hash if present
        const hash = window.location.hash;
        if (hash) {
            const tab = document.querySelector(`#caseDetailsTabs a[href="${hash}"]`);
            if (tab) {
                tab.tab('show');
            }
        }
        
        // Update URL hash when tabs change
        const tabElements = document.querySelectorAll('#caseDetailsTabs button');
        tabElements.forEach(tab => {
            tab.addEventListener('shown.bs.tab', function(e) {
                const id = e.target.getAttribute('data-bs-target');
                if (history.pushState) {
                    history.pushState(null, null, id);
                } else {
                    location.hash = id;
                }
            });
        });
    });
</script>
{% endblock %}