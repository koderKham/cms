{% extends "base_team.html" %}
{% block team_content %}
  <h2>Notes</h2>
  <form method="get" class="row g-2 mb-3">
    <div class="col-auto">
      <input type="text" name="search" class="form-control" placeholder="Search note text..." value="{{ search }}">
    </div>
    <div class="col-auto">
      <select name="user_id" class="form-select">
        <option value="">All Users</option>
        {% for user in users %}
          <option value="{{ user.id }}" {% if user.id == user_id %}selected{% endif %}>{{ user.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="client_id" class="form-select">
        <option value="">All Clients</option>
        {% for client in clients %}
          <option value="{{ client.id }}" {% if client.id == client_id %}selected{% endif %}>{{ client.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="case_id" class="form-select">
        <option value="">All Cases</option>
        {% for case in cases %}
          <option value="{{ case.id }}" {% if case.id == case_id %}selected{% endif %}>{{ case.style }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Filter</button>
      <a href="{{ url_for('notes_list') }}" class="btn btn-secondary">Clear</a>
    </div>
  </form>
  <a href="{{ url_for('note_create') }}" class="btn btn-primary mb-3">New Note</a>
  <table class="table">
    <thead>
      <tr>
        <th>Note</th>
        <th>Date Made</th>
        <th>User</th>
        <th>Case/Matter</th>
        <th>Client</th>
        <th>Event</th>
        <th>Document</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for note in notes %}
      <tr>
        <td><a href="{{ url_for('note_detail', note_id=note.id) }}">{{ note.note|truncate(40) }}</a></td>
        <td>{{ note.date_made.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ note.user.name }}</td>
        <td>{{ note.case.style if note.case else "" }}</td>
        <td>{{ note.client.name if note.client else "" }}</td>
        <td>{{ note.event.title if note.event else "" }}</td>
        <td>{{ note.document.filename if note.document else "" }}</td>
        <td>
          <a href="{{ url_for('note_edit', note_id=note.id) }}" class="btn btn-sm btn-secondary">Edit</a>
          <form action="{{ url_for('note_delete', note_id=note.id) }}" method="POST" style="display:inline;">
            <button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Delete this note?')">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}